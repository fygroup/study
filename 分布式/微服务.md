### 微服务
```
// 微服务架构
服务发现
网关
    分为接入网关和内部网关
    负载均衡、路由服务、安全认证、限流
配置中心
通讯方式
    rpc、http
    同步、异步(消息队列))
熔断、隔离、限流、降级
监控预警
容器编排
    k8s


// 重要模块
服务发现
通讯方式
容器编排
分布式事务



```

### 服务发现与负载均衡
```
http://ralphbupt.github.io/2017/11/27/etcd%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/
https://www.cnblogs.com/FireworksEasyCool/p/12912839.html

LB: load balancer 负载均衡服务

1、机制
    (1) 传统LB模式
        consumer -> LB -> service provider
        将服务信息配置到LB中，消费者访问LB，LB调用服务并返回结果给消费者

        运维难度大，存在单点故障

    (2) 进程内LB模式
                            +------------------+
                      +-----| service register |<-----+ 
                      |     +------------------+      |  
                      |                               |  
        +-------------↓--+                +------------------+
        | consumer + LB  |--------------->| service provider |
        +----------------+                +------------------+

        服务实例自动注册到服务注册中心
        定期发送心跳，反映服务可用
        服务消费者客户端带有服务发现和负载功能
        LB定期同步服务注册表中服务
        服务消费者通过LB调用服务实例
        
        客户端与LB耦合度过高

    (3) 独立主机LB模式
                            +------------------+
                      +-----| service register |<-----+ 
                      |     +------------------+      |  
                      |                               |  
        +-------------↓--+                +------------------+
        | consumer -> LB |--------------->| service provider |
        +----------------+                +------------------+

        每个主机上部署一个LB
        服务实例自动注册到服务注册中心
        定期发送心跳，反映服务可用
        LB定期同步服务注册表中服务信息
        消费端调用本机LB，LB实现负载均衡和远程调用

        运维成本高，每个客户端都需要安装独立的LB

2、工具架构
    Etcd + Registrator + Confd + Nginx
    Registrator: 通过检查容器在线或停止来完成相关服务数据的注册和更新
    Confd：读取Etcd中的数据来保持配置文件的最新状态
    Nginx：外部请求访问nginx实现负载均衡
                            更新注册        读取数据更新配置文件         配置文件更新 重启nginx   
    服务容器 -> Registrator --------> etcd <------------------- Confd ----------------------> nginx

    (1) etcd
        etcd 是一个分布式、可靠 key-value 存储的分布式系统。它不仅仅用于存储，还提供共享配置及服务发现
        Raft协议、提供http grpc接口
        (1) 一致性
            任意时刻至多存在一个有效的主节点
            主节点处理所有来自客户端写操作
            通过Raft协议保证写操作对状态机的改动会可靠的同步到其他节点




```

### 通讯方式
```
grpc + etcd 负载均衡


```

### 分布式事务
```

```

### 容器编排
```

```